/* © Clarify Cloud Limited 2013, 2014
All Rights Reserved
No part of this material or any of its contents may be reproduced, copied, modified or adapted, without prior written consent from Clarify Cloud Limited.
*/
function LogRowingData(){this.addElement=function(){rdLog.addRowingDataElement(rData)};this.saveArrayStorage=function(a){rdLog.saveArrayStorage(a)};this.clearArray=function(){rdLog.clearArray()}}var storedLogValues=[];var intervalLogRowingData=null;var timeForStorageSave=2000;function ExtractData(){var a=setInterval(function(){var b="paddle";b=statusItem.keyID;if(b!==null){if(b!="recovery"){rdLogArray.saveArrayStorage(b)}else{}}else{}},10000)}function sendToMongoDB(f){var c=txData.connectionState();var b;var a;var d=0;if(c){var i=$.jStorage.get(f);statusItem.blockUUID=txData.generateUUID();a=txData.initialTxData(i.rowDataArray,statusItem.blockUUID);i.savedToWeb=false;while(a.length!==0){txData.setSavingStatus(i.savingStatus,statusItem.blockUUID,"sending");txData.txToMongoDB(i,a,statusItem.blockUUID,f);$.jStorage.set(f,i);statusItem.blockUUID=txData.generateUUID();a=txData.initialTxData(i.rowDataArray,statusItem.blockUUID);d++}var h=2;var g=statusItem.sendTimeout+d*1000;var e=setTimeout(function(){i=txData.checkSendingStatus(f);var j=i;$.jStorage.set(f,j)},statusItem.sendTimeout);setTimeout(function(){var j=txData.repeatSendToWeb(f);if(!j){setTimeout(function(){j=txData.repeatSendToWeb(f);if(j){txData.askForAggregation(f)}else{}},g*2)}else{txData.askForAggregation(f)}},g)}else{BlockUUID="";txData.upDateSavingStatus(f,BlockUUID,false)}}function saveToLocalStorage(){rdLogArray.saveArrayStorage(statusItem.keyID);statusItem.keyToSend=statusItem.keyID;statusItem.keyID="recovery";rdLog.clearArray()}var intervalCloudSyn;var intervalLogRowingData;var intervalCheckFinish;function onConfirmSend(a){if(a==2){sendToMongoDB(statusItem.keyToSend);statusItem.pieceFinishedDataSend=true}}$(document).delegate("#dashboard","pageshow",function(a){if(statusItem.pieceState=="RUNNING"){results.getPieceData();statusItem.syncComplete=false;if(intervalCheckFinish){clearInterval(intervalCheckFinish);intervalCheckFinish=null}if(intervalLogRowingData){clearInterval(intervalLogRowingData);intervalLogRowingData=null}intervalCheckFinish=setInterval(function(){if((statusItem.pieceState=="STOP")||(statusItem.pieceState=="READY")){clearInterval(intervalCheckFinish);intervalCheckFinish=null;clearInterval(intervalLogRowingData);intervalLogRowingData=null;saveToLocalStorage();$.jStorage.reInit();setTimeout(function(){var d=$.jStorage.get(statusItem.keyToSend);if(d){var c=txData.connectionState();if(c){if(navigator.notification){navigator.notification.confirm("Data is ready for sending ",onConfirmSend,"Piece Finished",["Later","Send Now"])}else{var b=confirm("Send Data Now");if(b){onConfirmSend(2)}}}else{$.mobile.showPageLoadingMsg("a","Offline Cant Send Data ...",true);setTimeout(function(){$.mobile.hidePageLoadingMsg()},1000)}}},timeForStorageSave)}},1000);intervalLogRowingData=setInterval(function(){rData.setLogTime(new Date());var b=parseInt(rData.getIDX())+1;rData.setIDX(b);rdLogArray.addElement()},parseInt(statusItem.freqCollection))}});