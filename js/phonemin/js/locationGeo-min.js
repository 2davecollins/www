/* © Clarify Cloud Limited 2013, 2014
All Rights Reserved
No part of this material or any of its contents may be reproduced, copied, modified or adapted, without prior written consent from Clarify Cloud Limited.
*/
document.addEventListener("deviceready",onGeoDeviseReady,false);var platformTypeLocation;var geoWatch=null;var geoWatchFirst=null;function onGeoDeviseReady(){document.addEventListener("pause",onGeoPause,false);document.addEventListener("resume",onGeoResume,false)}function onGeoPause(){gData.clearWatches()}function onGeoResume(){setTimeout(function(){gData.startGeoRecord()},100)}$(document).delegate("#startpage","pagehide",function(){if((geoWatchFirst===null)&&(geoWatch===null)){gData.startGeoRecord()}});function Geoloc(){var j=[];var k=null;var i={maximumAge:0,timeout:1000,enableHighAccuracy:true};var f={enableHighAccuracy:true};var b={};var d={};var q=50;var p=null;var a=1000;this.startGeoRecord=function(){rData.setAccuracy(0);geoWatchFirst=navigator.geolocation.watchPosition(c,n,i)};var n=function(r){$("#geostatus").text("GPS waiting for position ensure location enabled ");$("#gpsState").text("GPS Searching..")};var o=function(r){$("#geostatus").text("GPS waiting for position ensure location enabled ");$("#gpsState").text("GPS Searching..")};this.clearWatches=function(){if(geoWatchFirst!==null){navigator.geolocation.clearWatch(geoWatchFirst);geoWatchFirst=null}if(geoWatch!==null){navigator.geolocation.clearWatch(geoWatch);geoWatch=null}};var c=function(r){$("#geostatus").text("");$("#gpsState").text("");if(r.coords.accuracy<q){b.lat=r.coords.latitude;b.lon=r.coords.longitude;b.acc=r.coords.accuracy;b.time=r.timestamp;b.heading=r.coords.heading;b.spd=r.coords.speed;j.push(b);navigator.geolocation.clearWatch(geoWatchFirst);geoWatchFirst=null;geoWatch=navigator.geolocation.watchPosition(l,o,i)}else{$("#geostatus").text("GPS Initializing..");$("#gpsState").text("GPS Initializing..");if(r.coords.accuracy!==null){rData.setAccuracy(r.coords.accuracy)}else{rData.setAccuracy(0)}}};var l=function(r){$("#geostatus").text("");$("#gpsState").text("");if(r.coords.accuracy<q){var s={};s.lat=r.coords.latitude;s.lon=r.coords.longitude;s.acc=r.coords.accuracy;s.time=r.timestamp;s.heading=r.coords.heading;s.spd=r.coords.speed;j.push(s);e()}else{$("#geostatus").text("GPS Initializing..");$("#gpsState").text("GPS Initializing..");if(r.coords.accuracy!==null){rData.setAccuracy(r.coords.accuracy)}else{rData.setAccuracy(0)}}while(j.length>4){j.shift()}};var e=function(){var u=h(j[j.length-2],j[j.length-1]);var y=m(j[j.length-2],j[j.length-1]);var t=y+rData.getDistance();var A=j[j.length-1].lat;var s=j[j.length-1].lon;var v=j[j.length-1].heading;var w=j[j.length-1].acc;var B=j[j.length-1].time;var z=j[j.length-1].spd;var x=new Date();var r=g(z);rData.setDistance(t);rData.setSpeed(r);rData.setSplitTime(z);rData.setLat(A);rData.setLon(s);rData.setHeading(v);rData.setAccuracy(w);rData.setLogTime(x)};var h=function(s,u){var w=6371000;var y=(u.lat-s.lat)*Math.PI/180;var r=(u.lon-s.lon)*Math.PI/180;var v=(s.lat)*Math.PI/180;var t=(u.lat)*Math.PI/180;var z=y*y+r*r*Math.cos((v+t)/2)*Math.cos((v+t)/2);var x=w*Math.sqrt(z);return x};var m=function(s,u){var w=6371000;var y=(u.lat-s.lat)*Math.PI/180;var r=(u.lon-s.lon)*Math.PI/180;var v=(s.lat)*Math.PI/180;var t=(u.lat)*Math.PI/180;var A=Math.sin(y/2)*Math.sin(y/2)+Math.sin(r/2)*Math.sin(r/2)*Math.cos(v)*Math.cos(t);var z=2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A));var x=w*z;return x};var g=function(s){var r=0;if(s!==null){if(s>0.1){r=500/s}else{r=0}}else{r="--"}return r}};